<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="edu.cumt.phyExperiment.dao.ExperimentTempDao">
    <select id="queryOneTempExperiment" resultType="edu.cumt.phyExperiment.entity.ExperimentTemp">
        SELECT temp_id, experiment_name, experiment_time, week_day, experiment_place
        , teacher_id, capacity, submit_teacher_id, state, audit_admin_account
        FROM experiment_temp WHERE temp_id = #{tempId}
    </select>
    <insert id="submitNewExperiment" parameterType="edu.cumt.phyExperiment.entity.ExperimentTemp">
        INSERT experiment_temp
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="experimentName != null and experimentName != ''">
                experiment_name,
            </if>
            <if test="experimentTime != null">
                experiment_time,
            </if>
            <if test="weekDay != null and weekDay != ''">
                week_day,
            </if>
            <if test="experimentPlace != null and experimentPlace != ''">
                experiment_place,
            </if>
            <if test="teacherId != null">
                teacher_id,
            </if>
            <if test="capacity != 0">
                capacity,
            </if>
            <if test="submitTeacherId != null">
                submit_teacher_id,
            </if>
        </trim>
        <trim prefix="VALUES(" suffix=")" suffixOverrides=",">
            <if test="experimentName != null and experimentName != ''">
                #{experimentName},
            </if>
            <if test="experimentTime != null">
                #{experimentTime},
            </if>
            <if test="weekDay != null and weekDay != ''">
                #{weekDay},
            </if>
            <if test="experimentPlace != null and experimentPlace != ''">
                #{experimentPlace},
            </if>
            <if test="teacherId != null">
                #{teacherId},
            </if>
            <if test="capacity != 0">
                #{capacity},
            </if>
            <if test="submitTeacherId != null">
                #{submitTeacherId}
            </if>
        </trim>
    </insert>
    <select id="queryAllTempExperiments" resultType="edu.cumt.phyExperiment.entity.ExperimentTemp">
        SELECT temp_id, experiment_name, experiment_time, week_day, experiment_place
        , teacher_id, capacity, submit_teacher_id, state, audit_admin_account
        FROM experiment_temp
    </select>
    <select id="queryAllAuditExperiments" resultType="edu.cumt.phyExperiment.entity.ExperimentTemp">
        SELECT temp_id, experiment_name, experiment_time, week_day, experiment_place
        , teacher_id, capacity, submit_teacher_id, state, audit_admin_account
        FROM experiment_temp WHERE state = 0
    </select>
    <select id="queryAllNotPassExperiments" resultType="edu.cumt.phyExperiment.entity.ExperimentTemp">
        SELECT temp_id, experiment_name, experiment_time, week_day, experiment_place
        , teacher_id, capacity, submit_teacher_id, state, audit_admin_account
        FROM experiment_temp WHERE state = 1
    </select>
    <select id="queryAllPassExperiments" resultType="edu.cumt.phyExperiment.entity.ExperimentTemp">
        SELECT temp_id, experiment_name, experiment_time, week_day, experiment_place
        , teacher_id, capacity, submit_teacher_id, state, audit_admin_account
        FROM experiment_temp WHERE state = 2
    </select>
    <select id="queryAuditExperimentsCount" resultType="int">
        SELECT COUNT(*) FROM experiment_temp WHERE state = 0
    </select>

    <select id="queryNotPassExperimentsCount" resultType="int">
        SELECT COUNT(*) FROM experiment_temp WHERE state = 1
    </select>

    <select id="queryPassExperimentsCount" resultType="int">
        SELECT COUNT(*) FROM experiment_temp WHERE state = 2
    </select>

    <select id="queryTeacherSubmitExperiments" resultType="edu.cumt.phyExperiment.entity.ExperimentTemp">
        SELECT temp_id, experiment_name, experiment_time, week_day, experiment_place
        , teacher_id, capacity, submit_teacher_id, state, audit_admin_account
        FROM experiment_temp WHERE submit_teacher_id = #{submitTeacherId}
    </select>

    <update id="updateSubmitExperimentInfo" parameterType="edu.cumt.phyExperiment.entity.ExperimentTemp">
        UPDATE experiment_temp
        SET
        <if test="experimentName != null and experimentName != ''">
            experiment_name = #{experimentName},
        </if>
        <if test="experimentTime != null">
            experiment_time = #{experimentTime},
        </if>
        <if test="weekDay != null and weekDay != ''">
            week_day = #{weekDay},
        </if>
        <if test="experimentPlace != null and experimentPlace != ''">
            experiment_place = #{experimentPlace},
        </if>
        <if test="teacherId != null">
            teacher_id = #{teacherId},
        </if>
        <if test="capacity != 0">
            capacity = #{capacity}
        </if>
        WHERE temp_id = #{tempId}
    </update>
    <update id="updateExperimentState">
        UPDATE experiment_temp
        SET state = #{state},
        audit_admin_account = #{auditAdminAccount}
        WHERE temp_id = #{tempId}
    </update>
</mapper>